<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
    <title>Nerealistické videoefekty - Jestřáblog</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link href="http://blog.petrnohejl.cz/favicon.ico" rel="icon">

    <!-- Open Graph tags -->
        <meta property="og:site_name" content="Jestřáblog" />
            <meta property="og:type" content="article"/>
            <meta property="og:title" content="Nerealistické videoefekty"/>
            <meta property="og:url" content="http://blog.petrnohejl.cz/nerealisticke-videoefekty"/>
            <meta property="og:description" content="V tomto článku bych chtěl popsat projekt, na kterém jsem pracoval v zimním semestru 2010 spolu s Petrem Panáčkem. Projekt se zabývá nerealistickými videoefekty. Text článku je převzat z dokumentace projektu pro předmět PGP. Úvod Cílem práce bylo nastudovat metody používané v nerealistickém zobrazování videa. Hlavním úkolem pak bylo navrhnout ..."/>
            <meta property="article:published_time" content="2011-01-05" />
            <meta property="article:section" content="Informační technologie" />

    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://blog.petrnohejl.cz/theme/css/bootstrap.cosmo.min.css" type="text/css"/>
    <link href="http://blog.petrnohejl.cz/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://blog.petrnohejl.cz/theme/css/pygments/monokai.css" rel="stylesheet">
    <link rel="stylesheet" href="http://blog.petrnohejl.cz/theme/css/style.css" type="text/css"/>
        <link href="http://blog.petrnohejl.cz/static/custom.css" rel="stylesheet">


</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://blog.petrnohejl.cz/" class="navbar-brand">
Jestřáblog            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="/categories.html">Categories</a></li>
                    <li><a href="/feed.xml">Feed</a></li>
                    <li><a href="http://petrnohejl.cz/">About me</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://blog.petrnohejl.cz/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<div class="container">
    <div class="row">
        <div class="col-lg-12">

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://blog.petrnohejl.cz/nerealisticke-videoefekty"
                       rel="bookmark"
                       title="Permalink to Nerealistické videoefekty">
                        Nerealistické videoefekty
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2011-01-05T00:00:00"> 5.1.2011</time>
    </span>



    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>V tomto článku bych chtěl popsat projekt, na kterém jsem pracoval v
zimním semestru 2010 spolu s Petrem Panáčkem. Projekt se zabývá
nerealistickými videoefekty. Text článku je převzat z dokumentace
projektu pro předmět
<abbr title="Pokročilá počítačová grafika">PGP</abbr>.</p>
<h2 id="uvod">Úvod</h2>
<p>Cílem práce bylo nastudovat metody používané v nerealistickém
zobrazování videa. Hlavním úkolem pak bylo navrhnout a implementovat
aplikaci realizující vybraný efekt na videosekvenci a zhodnotit možnosti
metod pro zpracování videa (stabilita mezi framy, plynulost pohybů
apod.). Nakonec bylo úkolem demonstrovat dosažené výsledky na vhodných
vstupech a vyhodnotit.</p>
<p>V rámci projektu jsme implementovali aplikaci demonstrující 3
nerealistické video efekty:</p>
<ul>
<li>Komiksový efekt</li>
<li>Malířský efekt</li>
<li>Mozaikový efekt</li>
</ul>
<h2 id="nerealisticke-videoefekty">Nerealistické videoefekty</h2>
<p>Nerealistické renderování je oblast počítačové grafiky, která se
zaměřuje na různé metody expresivního vyjádření (vykreslení) digitálního
obrazu. Jedná se o opačný proces vykreslování realistické grafiky, tedy
soubor technik vedoucích k výstupu, který nemá charakter
fotorealistického grafického výstupu. Zpravidla se používá tehdy, kdy je
potřeba imitovat různé techniky výtvarného umění nebo zvýraznit některé
rysy zobrazovaného útvaru. Vstupem je videosekvence reálného obrazu,
pořízená videokamerou, 3D scéna nebo jiná videosekvence. Výstupem filtru
je vyrenderovaná videosekvence s daným nerealistickým efektem. [1]</p>
<p>Příklady některých nerealistických efektů:</p>
<ul>
<li>Komiks (cartoon, comic)</li>
<li>Malířské techniky (painterly rendering)</li>
<li>Náčrtky (sketching)</li>
<li>Deformace obrazu (liquify)</li>
</ul>
<h3 id="komiksovy-efekt">Komiksový efekt</h3>
<p>Komiksový efekt napodobuje kreslený film. Výsledkem je segmentovaný
obraz s redukovaným rozsahem barev a se zvýrazněnými hranami (obr. 1).</p>
<p>Algoritmus pro vykreslování efektu používá metodu shlukování, konkrétně
algoritmus K-means (viz kapitola Algoritmy pro zpracování efektů). Při
každém vykreslení snímku nejprve proběhne výpočet počtu shluků. To
zajišťuje lepší stabilitu obrazu mezi jednotlivými snímky. Počet shluků
se určuje z barevnosti snímku pomocí histogramu a mění se jen při
výraznější změně barevnosti.</p>
<p>Algoritmus K-means segmentuje pixely obrazu do shluků podle 5 kritérií:
červená barevná složka, zelená barevná složka, modrá barevná složka,
pozice na ose x, pozice na ose y. Barva jednotlivých shluků se vypočítá
z průměru barev všech pixelů daného segmentu.</p>
<p>Nakonec se v obraze zvýrazní hrany pomocí Cannyho algoritmu pro detekci
hran (viz kapitola Algoritmy pro zpracování efektů). Ten najde v obraze
hrany, rozšíří je pomocí dilatace o určitou velikost a odpovídající
pixely ve výsledném obraze potom ztmaví o danou hodnotu.</p>
<p><img alt="Obr. 1: Ukázka komiksového efektu" src="http://blog.petrnohejl.cz/images/nerealisticke-videoefekty-01.jpg" /></p>
<h3 id="malirsky-efekt">Malířský efekt</h3>
<p>Malířský efekt imituje obraz malovaný štětcem na plátno. Výsledkem je
obraz složený z menších různobarevných oblastí, připomínající stopy
štětce (obr. 4).</p>
<p>Algoritmus zpracovává každý snímek videa v několika průchodech. V těchto
průchodech jsou do obrazu zakreslovány čáry o různých tloušťkách,
přičemž každá čára představuje jeden tah štětcem (obr. 3). Při
zpracování jednoho snímku je ze všeho nejdříve rozmazán původní obrázek.
V každém průchodu je poté obrázek překreslen jemnějším štětcem. Kromě
zmenšování tloušťky štětce je také v každém průchodu zvětšována hustota
zakreslovaných čar. Jinými slovy, je zmenšován krok průchodu obrazem.
Jemnější štětce jsou ovšem použity pouze v místech, kde se aktuální
obraz liší od původního rozmazaného obrazu. Díky tomu je zajištěna vyšší
stabilita mezi jednotlivými snímky. Překreslování tenčím štětcem tedy
slouží k odstranění nepřesností v aktuálním obraze. Po použití
jemnějšího štětce je obraz vždy znovu rozmazán. Rozmazání obrazu se
provádí pomocí algoritmu Gaussian blur (viz kapitola Algoritmy pro
zpracování efektů).</p>
<p>Směr kreslené čáry je určen kolmicí ke gradientu obrazu. Gradient je
vypočítán pomocí Sobelova filtru (viz kapitola Algoritmy pro zpracování
efektů) použitého ve směru osy x a y (obr. 2). Kolmice je poté získána
pouhým prohozením souřadných os a změnou znaménka jedné osy. Barva čáry
je vypočítána jako průměrná hodnota mezi počátečním a koncovým bodem
čáry, přičemž hodnota těchto bodů je brána z původního rozmazaného
obrazu. [2]</p>
<p><img alt="Obr. 2: Vykreslení čáry" src="http://blog.petrnohejl.cz/images/nerealisticke-videoefekty-02.jpg" /></p>
<p><img alt="Obr. 3: Vykreslování čar v jednotlivých průchodech (postupně zleva doprava)" src="http://blog.petrnohejl.cz/images/nerealisticke-videoefekty-03.jpg" /></p>
<p><img alt="Obr. 4: Ukázka malířského efektu" src="http://blog.petrnohejl.cz/images/nerealisticke-videoefekty-04.jpg" /></p>
<h3 id="mozaikovy-efekt">Mozaikový efekt</h3>
<p>Mozaikový efekt je jednoduchý a často používaný. Obraz napodobuje
mozaiku. Používá se pro skrytí detailů v obraze. Výsledkem je obraz
složený z větších jednobarevných čtverců (obr. 5).</p>
<p>Algoritmus rozděluje obraz na čtvercové oblasti o určité velikosti. Tyto
oblasti jsou potom obarveny jednou barvou, vypočtenou z průměru barev
všech pixelů původní oblasti.</p>
<p><img alt="Obr. 5: Ukázka efektu mozaiky" src="http://blog.petrnohejl.cz/images/nerealisticke-videoefekty-05.jpg" /></p>
<h2 id="algoritmy-pro-zpracovani-efektu">Algoritmy pro zpracování efektů</h2>
<h3 id="k-means">K-means</h3>
<p>Algoritmus K-means slouží k segmentaci obrazu. Obraz se skládá z <em>K</em>
regionů a každý pixel je klasifikován do jednoho z regionu. Každý region
je reprezentován středem μi. Pixel je klasifikován do regionu, jehož
střed je nejblíže (obr. 6).</p>
<p><img alt="Obr. 6: Ukázka segmentace podle K-means ve 2D (kříže znázorňují středy regionů μi)" src="http://blog.petrnohejl.cz/images/nerealisticke-videoefekty-06.jpg" /></p>
<p>Algoritmus K-means:</p>
<ol>
<li>Náhodně inicializuj středy regionů μi.</li>
<li>Klasifikuj pixely xn do regionů.</li>
<li>Vypočti nové středy regionů.</li>
<li>Opakuj kroky 2 a 3, dokud se středy shluků mění.</li>
</ol>
<h3 id="cannyho-hranovy-detektor-a-sobeluv-operator">Cannyho hranový detektor a Sobelův operátor</h3>
<p>Cannyho hranový detektor je algoritmus, který nalezne množinu hran
v obraze. Využívá Sobelův operátor ve směru <em>X</em> a <em>Y</em>, potlačení
nemaximálních hodnot a prahování s hysterezí. Zvýraznění hran pomocí
Cannyho algoritmu je vidět například v obr. 1.</p>
<p>Sobelův operátor je diskrétní diferenciální operátor, který počítá
aproximaci gradientu intenzity obrazu. Je založen na konvoluci obrazu
pomocí filtru v horizontálním a vertikálním směru. Zpravidla používá
konvoluční matice o velikosti 3x3 (vzorec 1).</p>
<p><img alt="Vzorec 1: Konvoluční matice Sobelova filtru (A je zdrojový obraz, G je výsledný gradient)" src="http://blog.petrnohejl.cz/images/nerealisticke-videoefekty-07.jpg" /></p>
<p>Potlačení nemaximálních hodnot (Non-maximum suppression) funguje tak, že
ve směru gradientu se potlačí pixely, které nejsou lokálním maximem
(obr. 7). Výsledkem je ztenčení tlustých hran potlačením nemaximálních
hodnot v černobílém obraze.</p>
<p><img alt="Obr. 7: Znázornění pixelů ve směru gradientu" src="http://blog.petrnohejl.cz/images/nerealisticke-videoefekty-08.jpg" /></p>
<p>Prahování s histerezí funguje tak, že silné hrany (větší než <em>High</em>)
jsou ponechány. Slabé jsou ponechány, pouze pokud jsou spojeny s nějakou
silnější hranou (obr. 8). Velmi slabé hrany jsou potlačeny (nižší než
<em>Low</em>). Obvykle platí: <em>High</em> = 2-3 * <em>Low</em>.</p>
<p><img alt="Obr. 8: Prahování s histerezí" src="http://blog.petrnohejl.cz/images/nerealisticke-videoefekty-09.jpg" /></p>
<h3 id="gaussian-blur">Gaussian blur</h3>
<p>Gaussian blur je často používaný algoritmus v počítačové grafice pro
redukci šumu a detailů. Funguje na principu konvoluce pomocí Gaussovské
funkce (vzorec 2). Gaussian blur je filtr s dolní propustí.</p>
<p><img alt="Vzorec 2: Dvou dimenzionální Gaussovská funkce" src="http://blog.petrnohejl.cz/images/nerealisticke-videoefekty-10.jpg" /></p>
<h2 id="implementace-aplikace">Implementace aplikace</h2>
<p>Aplikace demonstruje 3 video efekty: komiksový efekt, mozaikový efekt a
malířský efekt. Vstupem programu je typ efektu a název video souboru ve
formátu AVI. Výstupem jsou dvě okna, zobrazující video. První ukazuje
originální obraz, druhé zobrazuje vyrenderovaný obraz, na který byl
aplikován daný efekt.</p>
<p>Program demonstrující výše zmíněné nerealistické efekty je implementován
v jazyce C/C++, v prostředí Visual Studio 2008. Používá knihovnu OpenCV.
Pro úspěšné sestavení projektu je nutné mít nainstalovanou tuto knihovnu
a správně definovány v nastavení projektu knihovny pro linker.</p>
<p>Každý efekt je implementován ve vlastní třídě (<em>effectComic</em>,
<em>effectPainterly</em>, <em>effectMosaic</em>). Na začátku každého zdrojového
souboru s efektem jsou definovány konstanty, ovlivňující různé
vlastnosti při výpočtu efektu. Konstanty lze měnit a ovlivňovat tak
některé parametry efektu. Třída <em>effects</em> se stará o základní zpracování
obrazu - načtení videa ze souboru a zobrazení na výstup.</p>
<p>Ovládání aplikace:</p>
<ul>
<li><em>VideoEffects.exe -h</em> - zobrazí nápovědu</li>
<li><em>VideoEffects.exe -c inputVideo</em> - demonstruje komiksový efekt</li>
<li><em>VideoEffects.exe -p inputVideo</em> - demonstruje malířský efekt</li>
<li><em>VideoEffects.exe -m inputVideo</em> - demonstruje mozaikový efekt</li>
</ul>
<p><em>inputVideo</em> je název vstupního video souboru ve formátu AVI.</p>
<h2 id="zaver">Závěr</h2>
<p>Nerealistické vykreslování obrazu může mít různé využití. Používá se
například v moderních videokamerách pro „umělecké“ efekty, mobilních
telefonech s fotoaparátem nebo také v programech pro střihání videa.
Využití může nalézt i v zábavném průmyslu, např. v počítačových hrách
nebo aplikacích na webu.</p>
<p>Díky projektu jsme se naučili metody a principy pro nerealistické
renderování obrazu. Naučili jsme se nové algoritmy pro zpracování obrazu
a prohloubili si znalosti v programování aplikací v OpenCV.</p>
<p>Zdrojové soubory projektu na <a href="https://github.com/petrnohejl/Non-Realistic-Video-Effects">github.com</a>.</p>
<h2 id="zdroje">Zdroje</h2>
<p>[1] Non-photorealistic rendering. In Wikipedia : the free encyclopedia
[online]. St. Petersburg (Florida) : Wikipedia Foundation, 9.1.2005,
last modified on 14.10.2010 [cit. 2010-12-28]. Dostupné z WWW:
http://en.wikipedia.org/wiki/Non-photorealistic_rendering.</p>
<p>[2] HERTZMANN, Aaron; PERLIN, Ken. Painterly rendering : Painterly
Rendering with Curved Brush Strokes of Multiple Sizes [online]. New
York University, Media Research Laboratory : 2000 [cit. 2010-12-29].
Dostupné z WWW: http://mrl.nyu.edu/projects/npr/painterly/.</p>
<p>[3] Matlab Central [online]. 27.3.2008 [cit. 2010-12-29]. Efficient
K-Means Clustering. Dostupné z WWW:
http://www.mathworks.com/matlabcentral/fileexchange/19344-efficient-k-means-clustering-using-jit.</p>
<p>[4] Sobel operator. In Wikipedia : the free encyclopedia [online]. St.
Petersburg (Florida) : Wikipedia Foundation, 19.2.2004, last modified on
12.12.2010 [cit. 2010-12-29]. Dostupné z WWW:
http://en.wikipedia.org/wiki/Sobel_operator.</p>
            </div>
            <!-- /.entry-content -->
    <hr />
    <section class="comments" id="comments">
        <h2>Comments</h2>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'petrnohejl'; // required: replace example with your forum shortname
            var disqus_identifier = 'nerealisticke-videoefekty';
            var disqus_url = 'http://blog.petrnohejl.cz/nerealisticke-videoefekty';
            var disqus_config = function () {
                this.language = "cs";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2014 Petr Nohejl
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>              <p><small>  <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a>
    Content
  licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution 4.0 International License</a>, except where indicated otherwise.
</small></p>
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://code.jquery.com/jquery.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://blog.petrnohejl.cz/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://blog.petrnohejl.cz/theme/js/respond.min.js"></script>

    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'petrnohejl'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-17930136-2']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();

    </script>
</body>
</html>